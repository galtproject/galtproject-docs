# Контракт CreateTerritory - Документация

## Описание проблемы
Каждый, подтвердив свое право не землю, в той или иной юрисдикции может включить ее в `Проект` и стать его `Участником` (см. - Контракт AddNewPlot).
Если Земельный участок достаточно большой, то `Участник проекта` может с согласия всех остальных `Участников проекта` или GALT Project CORE Team продать этот Земельный участок за Эфиры всем желающим. Покупка происходит в 2 этапа, сначала покупатели покупают Токены GALT, выпущенные под этот большой `Земельный участок`, а потом полученными за Эфиры токенами GALT участвуют в `Аукционе земли` за `Земельные участки` меньшего размера.

Согласно общей схеме `Аукциона земли` существует неограниченной количество `Аукционов земли`, каждый из которых является отдельным умным контрактом `SPACEAuction`, адреса этих контрактов хранятся в контракте `SPACEAuctionRegistry`. 
В рамках отдельного контракта `SPACEAuction` каждый может создать `Лот` и выиграть `Земельный участок` за токены GALT.
Для того, чтобы управлять тем, на какие `Земельные участки` можно создавать `Лот` на конкретном `Аукционе земли`, а какие нет вводится понятие `Территории`. Территория - это токен стандарта ERC721, который принадлежит контракту SPACEAuctionRegistry. 

Эти токены используются для проверки того, что `Геохеш-участок` или `Упаковка`, который Пользователь хочет поставить на `Аукцион земли` - допустим для конкретного Аукциона.

Приведем пример:
- `Геохеш-участок` [w24qg]( https://explorer.galtproject.io/map/#w24qg ). Это Территория, если Токен `w24qg` принадлежит контракту `SPACEAuctionRegistry`.
- Токен SPACE `Упаковки` 743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbk тоже Территория, если этот токен принадлежит контракту `SPACEAuctionRegistry`.

### Новые Термины
- `Заявка на Краудсейл` - запись в контракте CreateTerritory, соответствующая предложению о выпуске новых Токенов GALT и продаже `Территории` за Эфиры широкому кругу лиц.
- `Владелец Территории` - физическое лицо, юридическое лицо, экономический агент, который владеет участком земли в той или иной юрисдикции. Может при помощи тех или иных юридических механизмов продать землю `Участникам проекта`. Имеет свой адрес в сети Ethereum и получает Эфиры за землю.
- `Оператор ввода Территории в проект или Оператор ввода` - физическое лицо, юридическое лицо, экономический агент, который предлагает включить `Территорию` в `Проект`. Имеет свой адрес в сети Ethereum и получает Эфиры от Владельца Территории, как комиссионное вознаграждение.

При подаче `Заявки на Краудсейл` нужно следовать следующим условиям:
- На момент подачи `Заявки на Краудсейл` токены SPACE, которые соответствуют `Территории` принадлежат `Владельцу Территории`.
- В `Заявке на Краудсейл` могут быть указаны несколько токенов SPACE.
- Для осуществления продажи `Территории` - необходимо передать её во владение `SPACEAuctionRegistry`: 
  - если токен(или токены) Территории являются `Упаковками` и будут участвовать в Аукционе без разделения, то он(они) полностью будет передан от контракта  `SPACEAuctionRegistry` на конкретный контракт `SPACEAuction`;
  - если токен (или токены) Территории являются `Геохеш - участками`, то эти Токены будут переданы `SPACEAuctionRegistry` без дальнейшей передачи конкретному контракту `SPACEAuction`.

Пользователь может купить всю `Территорию` или отдельные `Земельные участки` на Аукционе двумя способами:

1. В Аукционе участвуют Токены SPACE так, как они были указаны в `Заявке на Краудсейл`, без разделения. Токены являются `Упаковками`.

Пример: В `Заявки на Краудсейл` были указаны 2 токена SPACE, которые были переданы контракту SPACEAuctionRegistry.

|Токен SPACE |Принадлежит|
|-----------------|----------|
|743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbk|SPACEAuctionRegistry|
|743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbb|SPACEAuctionRegistry|

`Владелец Территории` решил, что эти токены будут участвовать в Аукционе, как единое целое. После запуска конкретного контракта `SPACEAuction_465` они были переданы контракту `SPACEAuction_465`.

|Токен SPACE |Принадлежит|
|-----------------|----------|
|743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbk|SPACEAuction_465|
|743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbb|SPACEAuction_465|

Любой может сделать ставку на любой из двух токенов и выиграть их в случае успеха.

2. Пользователь может сделать ставку на любой `Геохеш - участок` любого разряда, если он находится в границах `Территории`.

Пример: 

В `Заявки на Краудсейл` был указан 1 токен SPACE, который был передан контракту SPACEAuctionRegistry.

|Токен SPACE Территории для продажи Проекту|Принадлежит|
|-----------------|----------|
|[w24qg]( https://explorer.galtproject.io/map/#w24qg )|SPACEAuctionRegistry|

`Владелец Территории` решил, что Территорию можно разделить на `Геохеш-участки` без ограничений по размеру. После запуска конкретного контракта `SPACEAuction_466` Токен [w24qg]( https://explorer.galtproject.io/map/#w24qg ) остается у SPACEAuctionRegistry.

Пользователь хочет создать `Лот` и приобрести участок с геохешем [w24qge](https://explorer.galtproject.io/map/#w24qge). Геохеш [w24qge](https://explorer.galtproject.io/map/#w24qge)  входит в [w24qg]( https://explorer.galtproject.io/map/#w24qg ) и соответствено Пользователь может создать на него `Лот` и выиграть на `Аукционе`.

Если пользователь попытается создать заявку на [w24qex](https://explorer.galtproject.io/map/#w24qex), то он не сможет это сделать так как данный участок находится за пределами допустимой Территории. В нашем случае аналогом Территории является допустимое пространство имен для `Аукциона земли` `SPACEAuction_466`.

## Цели контракта
- создать механизм продажи больших `Земельных участков` за Эфиры `Участникам проекта`;
- обеспечить возможность вознаграждения текущего `Владельца земли`;
- защитить владельцев токенов GALT и владельцев земли (владельцев токенов SPACE) от мошенничества и размытия своих инвестиций;
- создать мотивацию для независимых `Операторов ввода` искать и вводить новые территориии в проект;

## Общая схема
- Каждый (`Оператор ввода`) должен иметь возможность создать `Заявку на Краудсейл` на продажу большого `Земельного участка` за Эфиры. 
- Токен SPACE `Упаковки` территории и все токены SPACE `Геохеш - участков` должны быть созданы заранее и принадлежать адресу Владельца Территории;
- В результате выкупа `Владелец территории` получает средства за свою землю, а `Участники проекта` - возможность получить новые участки на `Аукционе земли`.

## Сценарий контракта

### Сценарий №1 "Создание заявки на новую Территорию на выкуп через дополнительную эмиссию GALT. В заявке указываются готовые токены SPACE `Упаковок`. В Аукционе земли будут участвовать только указанные в Заявке Токены SPACE."

Входные данные из контрактов:

|Токен SPACE |Владелец|
|-----------------|----------|
|743883bs7GEOw24qgy48hgdhhqfhfhqw663w24qg464mbk|<Адрес Владельца Территории>|
|686743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbd|<Адрес Владельца Территории>|
|36374683bs7GEOw24qdhjsssdhhqgddqw47457w24qgumgga|<Адрес Владельца Территории>|

1. `Оператор ввода` может вызвать метод CreateNewTerritoryProposal() и создать `Заявку на Территорию`. В  ней `Оператор ввода` указывает:

| Параметр | Значение | Комментарий |
|---------|-----------| ----------- |
| Адрес `Владельца Территории` | <адрес> |Адрес, куда должны быть перечислены Эфиры. |
| Токен Территории| 743883bs7GEOw24qgy48hgdhhqfhfhqw663w24qg464mbk| Токен SPACE `Упаковки`.|
| Минимальная ставка в GALT| 1000 | Минимальная ставка на SPACE Токен `Упаковки`, которые указаны в заявке. |
| Стоимость в Эфирах| 15 000 | Эта сумма, которую хочет получить владелец за все Токены SPACE, указанные в Заявке.|
| Количество выпускаемых GALT| 15 000 000 | Эта сумма GALT, которая будет выпущена.|
| Длительность Краудсейла | 90 дней |        |
| Размер вознаграждения `Владельца территории` | 13 500 | |
| Адрес `Фонда` | <адрес> | Если привлекаемые эфиры распределяются в определенном отношении между текущим владельцем земли и Фондом, то здесь указыватся адрес фонда.|
| Размер вознаграждения `Фонда` | 1500 | |
| Размер вознаграждения `Оператора ввода` | 1350 | |
| Время жизни Заявки в днях | 10 |Это означает, что если по заявке не принято положительное решение в течение 10 дней, то она автоматически получает статус отказа.|
| Адрес задеплоенного контракта TerritoryCrowdsale | адрес |Это контракт, который в случае принятия Заявки будет добавлен в контракт GaltGenesisRegistry|
| Адрес задеплоенного контракта `Аукциона Земли` | адрес |Это контракт, который в случае принятия Заявки будет добавлен в контракт SPACEAuctionRegistry |
| Погрешность по сбору Эфиров | 10 | В этом случае, если было собрано 14 992 или 15 009, то Краудсейл считается успешным.|
| Тип продажи| Участки фиксированы/Участки не фиксированы | |

Происходит проверка, что указанные Токены Территории в Заявке принадлежат адресу, указанному Владельцем Территории.

2. `Оператор ввода` или  `Владелец Территории` вызывает метод addPlot() для каждого нового Токена SPACE, который он хочет добавить:

|Заявка|Позиция|Токен SPACE |Признак принадлежности|
|-------------|-------|-----------------|----------|
|id заявки|1|743883bs7GEOw24qgy48hgdhhqfhfhqw663w24qg464mbk|Аукцион|
|id заявки|2|686743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbd|Аукцион|

Добавил Токен 686743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbd.

После этого добавил токен 36374683bs7GEOw24qdhjsssdhhqgddqw47457w24qgumgga и указал признак `Фонд`. Это значит, что Токен не попадет на Аукцион, а будет передан `Фонду`.

|Заявка|Позиция|Токен SPACE |Признак принадлежности|
|-------------|-------|-----------------|----------|
|id заявки|1|743883bs7GEOw24qgy48hgdhhqfhfhqw663w24qg464mbk|Аукцион|
|id заявки|2|686743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbd|Аукцион|
|id заявки|3|686743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbd|Фонд|


3. Заявку должен утвердить `Владелец Территории`, вызвав функцию confirmSale.

4. Заявка готова к голосованию. Все `Владельцы репутации` голосуют своей `Репутацией` по этой `Заявке`. Каждый голос увеличивает значение переменной TerritoryPropVote. 
Например, пользователь А имеет репутацию 1340. По заявке он может проголосовать за или против.
Пусть пользователь проголосовал ЗА. В таком случае:

| Параметр | Значение до | Значение после |
|---------|-----------| ----------- |
|TerritoryPropVote |10 000| 11 340 |

Если получено 66% от общей репутации всех участников, то заявка принимается. Один адрес может проголосовать по одной заявке только один раз.

| Заявка  | Общая репутация | TerritoryPropVote | Процент |
|---------|---------|-----------| ----------- |
|id заявки|100 000 000 |68 000 000| 68% |

Если время жизни заявки истекло и не было принято положительное решение, то заявка считается отклоненной.

GALT PROJECT CORE TEAM может принять заявку в обход голосования или наложить вето на заявку до момента передачи всех контрактов Сообществу.

5. Если Заявка была принята, то `Владелец земли` обязан передать владение всеми токенами SPACE из заявки на адрес `SPACEAuctionRegistry`, вызвав на контракте заявки функцию confirmTransfer() для каждого SPACE токена.

|Токен SPACE |Владелец|
|-----------------|----------|
|743883bs7GEOw24qgy48hgdhhqfhfhqw663w24qg464mbk|SPACEAuctionRegistry|
|686743883bs7GEOw24qgy48hgdhhqgddqw663w24qgumbd|SPACEAuctionRegistry|
|36374683bs7GEOw24qdhjsssdhhqgddqw47457w24qgumgga|SPACEAuctionRegistry|

6. После передачи и подтверждения всех токенов SPACE из заявки - владелец должен вызвать функцию initCrowdsale() у контракта CreateTerritory с передачей адреса `Аукциона земли` как аргумента.
7. Функция initCrowdsale() инициирует в контракте [SPACEAuctionRegistry](SPACEAuctionRegistry.md) добавление нового адреса `Аукциона земли` в реестр, и закрепляет за ним адрес заявки для определения прав: какую землю имеет право продавать данный `Аукцион земли`.

6. Далее - Контракт [TerritoryCrowdsale](TerritoryCrowdsale.md).

## Неоднозначные вопросы
### Кто должен голосовать за ввод новых территорий?
Теоритически голосовать могут:
- владельцы земельных участков (держатели токенов SPACE стандарта ERC721);
- делегаты фондов;
- владельцы токенов GALT стандарта ERC20;

Нужно принять решение о том, кто из этих групп должен участвовать в голосовании, а кто нет.
### Какой процент голосов должен быть набран для ввода новых территорий?
### Кто должен владеть токеном Территории?
Токеном территории должен владеть контракт Генезиса на эту территорию или контракт аукциона на эту территорию.
### Сколько нужно контрактов Генезиса и контрактов аукциона?
На каждую новую территорию будет создаваться отдельный контракт генезиса на привлечение инвестиций и контракт аукциона на распределение это территории.
### Какие функции Оператора ввода Территории в проект?
### Как будет юридически оформлена передача земли от Владельца Территории проекту?
### Должен ли токен SPACE передаваться от SPACEAuctionRegistry на конкретный SPACEAuction?
